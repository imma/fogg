#!/usr/bin/env bash

function main {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"
  source "$shome/script/profile"
  source normalize

  set -x

  local remote_path="$(fogg config | jq -r '.remote_path')"
  local remote_bucket="$(fogg config | jq -r '.remote_bucket')"

  aws dynamodb get-item --table-name terraform_state_lock --key "$(jq -n --arg remote "${remote_bucket}/${remote_path}" '{LockID: {S: "\($remote)-md5"}}')"
  aws dynamodb delete-item --table-name terraform_state_lock --key "$(jq -n --arg remote "${remote_bucket}/${remote_path}" '{LockID: {S: "\($remote)-md5"}}')"
}

source sub "$BASH_SOURCE" "$@"


